<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Secure Data Science with Amazon SageMaker Studio Workshop</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="86b3f84d-418e-4b7d-9887-c00c1c3e3cd7" class="page sans"><header><h1 class="page-title"><strong>Secure Data Science with Amazon SageMaker Studio Workshop</strong></h1></header><div class="page-body"><nav id="3b4ba02b-ec2f-46cd-86e8-c2581fbe61b2" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#bdcc9788-7849-4912-97da-ace9d035e5b1">Secure SageMaker Studio <strong>Architecture Diagram</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1d59aef0-9036-4af5-8d50-dac850893ae9">Scenario</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e9cd2960-a253-4251-953d-28761ac47373"><strong>Prerequisites</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a843a9dc-aae7-4e1a-bf74-ce4914b84fef"><strong>Lab 1: Best Practice as Code</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#574880dc-1c18-4a5b-8921-306aefbbaa03"><strong>Upload CloudFormation templates to S3 bucket in your account:</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#80b50a10-64de-4d24-8c8d-9e27db76ff46"><strong>Upload Dataset to the S3 data lake bucket</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b82084ba-bb48-4d81-b5b6-c295aeb9393a"><strong>Install approved Python packages in Code Artifact repository</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b74eb767-7a40-4dbe-ad22-f495cd149735"><strong>Build a custom SageMaker image and upload to Amazon Elastic Container Registry (ECR) repository</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#93968239-671c-4c81-af3e-bba959a6a9b0"><strong>Lab 2: Secure SageMaker Studio Domain</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c7128dda-c8b4-483a-8827-69c818a0fa7e">Assume Data Science Admin Role</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f4b56be5-170e-433a-a928-d3ec4ca89749">Onboard SageMaker Studio Domain</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#ebfc7a78-ed9d-421b-bac3-173327b181d6">Lab 3 - Secure Team Environment</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#28bb73ef-51df-42ef-a304-d3f6df246eed">Deploy a data science environment</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#dd50d13b-1b43-4835-86b5-f4c4dbe12eca"><strong>Create SageMaker Studio Domain users for a data science environment</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#00490fe7-8640-4c68-826b-5dbc47701eab">Lab 4 - Launch SageMaker Studio IDE</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#bc2b1b9e-9723-4253-ae97-afc959480b06">Assume Data Science User Role</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c51915cd-b73b-4d03-8607-3cd3e2ecbac2">Launch SageMaker Studio IDE</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#dc6ebce3-48fc-4daa-b35b-19d318e5babb">Clone Git Repository to SageMaker Studio</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#f0009dd3-b84f-40ae-bb58-00ee28078fa8"><strong>Configure SageMaker Studio Notebook Environment</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#7f56945e-6ed6-4b85-8b3e-8efb85928a8d">Lab 5 - Detective and Corrective Controls</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#2729bfc7-33a3-4df8-82bf-7f22345beb37">Environment Setup for the Demo Notebook</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#188f8dad-f9bb-4e58-b357-2e882fdf1d86"><strong>Pre-processing and Feature Engineering</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5708f14b-0d70-42f4-8163-0d2e0184a6c8">Model Development and Training</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#c8fddd5c-02ca-48a0-8e3d-2a8676dffe6f"><strong>What Have We Accomplished</strong></a></div></nav><hr id="bf5aaceb-8b84-4489-a3ba-56544535baa9"/><h2 id="bdcc9788-7849-4912-97da-ace9d035e5b1" class="">Secure SageMaker Studio <strong>Architecture Diagram</strong></h2><figure id="42a6ddbb-f808-498e-a211-07e14276ef39" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/sec-ds-architecture-simplified.png"><img style="width:851px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/sec-ds-architecture-simplified.png"/></a></figure><hr id="37d0c09d-05f2-4623-b761-3320a95126ec"/><h2 id="1d59aef0-9036-4af5-8d50-dac850893ae9" class="">Scenario</h2><p id="44ca372b-781a-430b-be80-7448cfa16590" class="">You are a member of a Cloud Platform Engineering team that has been tasked with enabling your business&#x27;s data scientists to deliver machine learning models and artifacts that are trained on highly sensitive company and customer data. The data science teams are constrained by shared on-premise resources so you have been tasked with determining how the business can leverage the cloud to provision environments for the data science teams. The environment must be secure, protecting the sensitive data, while also enabling the data science teams to self-service.</p><p id="0e78ca6f-dbe1-4a8e-977f-d4c4b81d3f05" class="">
</p><p id="6559c5b1-534c-4dd2-be06-9db504539381" class="">During this series of labs, you will be creating a secure environment for a team of data scientists with self-service tools to manage the environment and deliver ML models.</p><p id="9548fc9d-a16a-4851-8e10-cb6904a5d364" class="">There are three personas involved across these labs:</p><ul id="be99d59f-a2c4-425c-80a0-2c70d30edbe3" class="bulleted-list"><li style="list-style-type:disc"><strong>Cloud Platform Engineering</strong> - responsible for managing the cloud environments</li></ul><ul id="4833d143-f3c8-429b-9812-a2a358bb8c2e" class="bulleted-list"><li style="list-style-type:disc"><strong>Data Science Administrators</strong> - responsible for managing resources to support the data science teams</li></ul><ul id="df5f4f4c-0c3d-48a8-87b9-ea83e9646af9" class="bulleted-list"><li style="list-style-type:disc"><strong>Data Scientist</strong> - a member of a data science team tasked with delivering an ML or data science model<figure id="b6ab801f-c5d8-4879-b343-42017312fad4" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/secure-ds-personas.png"><img style="width:814px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/secure-ds-personas.png"/></a></figure></li></ul><hr id="3ea5e3bf-6a67-4152-909d-66e5ab042add"/><h2 id="e9cd2960-a253-4251-953d-28761ac47373" class=""><strong>Prerequisites</strong></h2><ol type="1" id="8f2cafef-4ff0-43d1-b217-c76f037fda0a" class="numbered-list" start="1"><li>Go to the AWS Management Console, search for cloud9 in search box and then select <strong>Cloud9</strong>.<figure id="61f6b0bb-e1e6-4cd6-a7e1-dd33ee151a58" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/cloud9-aws-console-search.png"><img style="width:2054px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/cloud9-aws-console-search.png"/></a></figure></li></ol><ol type="1" id="0bdab20c-52cd-4fe3-a347-d69958165dfc" class="numbered-list" start="2"><li>Click <strong>Create environment.</strong><figure id="c479433e-4a8a-49a5-83b5-86eb77d115c8" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/cloud9-start-create-env.png"><img style="width:2720px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/cloud9-start-create-env.png"/></a></figure></li></ol><ol type="1" id="31d85e90-be8b-443a-afb7-5b54e3fe0a13" class="numbered-list" start="3"><li>Enter <code>secure-sm-studio-workshop</code> into <strong>Name </strong>and optionally provide a <strong>Description. </strong>Click <strong>Next step</strong>.<figure id="4194f762-5ecf-43ab-9930-254d5bd31fce" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/cloud9-env-name.png"><img style="width:2190px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/cloud9-env-name.png"/></a></figure></li></ol><ol type="1" id="335570e0-fd7b-4051-b992-68bf88a53b8c" class="numbered-list" start="4"><li>You may leave <strong>Environment settings </strong>at their defaults of launching a new <strong>t3.small </strong>EC2 instance which will be paused after <strong>30 minutes </strong>of inactivity. Click <strong>Next step</strong>.<figure id="92cafd90-0f22-402c-a060-791436e6ce21" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/screenshot-ap-southeast-1.console.aws.amazon.com-2022.06.24-17_59_53.png"><img style="width:2052px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/screenshot-ap-southeast-1.console.aws.amazon.com-2022.06.24-17_59_53.png"/></a></figure></li></ol><ol type="1" id="8b151360-eab1-4633-bb89-5b08f270ee7d" class="numbered-list" start="5"><li>Review the environment settings and click <strong>Create environment</strong>. It will take several minutes for your environment to be provisioned and prepared.<figure id="974a15e7-6586-423b-b1e9-d5b99f7032c4" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/screenshot-ap-southeast-1.console.aws.amazon.com-2022.06.24-18_03_42.png"><img style="width:3200px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/screenshot-ap-southeast-1.console.aws.amazon.com-2022.06.24-18_03_42.png"/></a></figure></li></ol><ol type="1" id="e2c72d56-e97b-4e35-9f6f-cec6d7110edf" class="numbered-list" start="6"><li>Once ready, your IDE will open to a <code>Welcome</code> tab and <code>AWS Toolkit -Quick Start</code> tab. The central panel of the IDE has two parts: a text/code editor in the upper half, and a terminal window in the lower half. Below the welcome screen in the editor, you should see a terminal prompt similar to the following (you may need to scroll down below the welcome screen to see it):<figure id="bafa0733-d80d-4e97-9ffc-3efdcdfc8a60" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/sm-setup-cloud9-terminal.png"><img style="width:3014px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/sm-setup-cloud9-terminal.png"/></a></figure></li></ol><ol type="1" id="34476d30-9ccb-44db-b56e-1bf76fdd3cb1" class="numbered-list" start="7"><li>Closing the <strong>Welcome tab</strong> and <strong>AWS Toolkit -Quick Start</strong>. We will use the bash terminal in the lower work area for the following steps.<figure id="bd4a4f09-f062-4aa0-9e36-92dbb92e274b" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/cloud9-1.png"><img style="width:3016px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/cloud9-1.png"/></a></figure></li></ol><ol type="1" id="2423974c-2088-4bcd-bdcb-1a3a15961829" class="numbered-list" start="8"><li>Install awscli v2 and other relevant packages.</li></ol><pre id="e83f9be8-e249-43c3-b434-d0ce43d419b4" class="code code-wrap"><code>curl &quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot; -o &quot;awscliv2.zip&quot;
unzip awscliv2.zip
sudo ./aws/install
sudo yum -y install jq bash-completion
</code></pre><ol type="1" id="9363bb50-4fc8-4b39-bdac-f8510cee725f" class="numbered-list" start="9"><li>Set up AWS_DEFAULT_REGION and AWS_ACCOUNT_ID environment variables.</li></ol><pre id="fb009b4b-c1c9-4624-aafb-29e8e7d7876a" class="code code-wrap"><code>echo &quot;export AWS_DEFAULT_REGION=`curl -s http://169.254.169.254/latest/dynamic/instance-identity/document|jq -r .region`&quot; &gt;&gt;  ~/.bash_profile
echo &quot;export AWS_ACCOUNT_ID=`curl -s http://169.254.169.254/latest/dynamic/instance-identity/document|jq -r .accountId`&quot; &gt;&gt;  ~/.bash_profile
.  ~/.bash_profile
</code></pre><ol type="1" id="3c82aa79-bbb5-4198-983a-acdd606635fc" class="numbered-list" start="10"><li>Increase disk space for the root volume of EC2 instance that Cloud9 runs on.</li></ol><blockquote id="ed7bd355-3ff4-42a7-b5c1-a3b7f526ea07" class=""><mark class="highlight-red">The following command adds more disk space to the root volume of the EC2 instance that Cloud9 runs on. Once the command completes, we reboot the instance and it could take a minute or two for the IDE to come back online.</mark></blockquote><pre id="ecb7ab6d-7bfb-4f69-a63a-664d2959cebc" class="code code-wrap"><code>pip3 install --user --upgrade boto3
export instance_id=$(curl -s http://169.254.169.254/latest/meta-data/instance-id)
python3 -c &quot;import boto3
import os
from botocore.exceptions import ClientError
region = os.getenv(&#x27;AWS_DEFAULT_REGION&#x27;)
if (region == &#x27;us-east-2&#x27;):
    ec2 = boto3.client(&#x27;ec2&#x27;, region_name=region, endpoint_url=&#x27;https://api.ec2.us-east-2.aws&#x27;)
else:
  ec2 = boto3.client(&#x27;ec2&#x27;)
volume_info = ec2.describe_volumes(
    Filters=[
        {
            &#x27;Name&#x27;: &#x27;attachment.instance-id&#x27;,
            &#x27;Values&#x27;: [
                os.getenv(&#x27;instance_id&#x27;)
            ]
        }
    ]
)
volume_id = volume_info[&#x27;Volumes&#x27;][0][&#x27;VolumeId&#x27;]
try:
    resize = ec2.modify_volume(
            VolumeId=volume_id,
            Size=40
    )
    print(resize)
except ClientError as e:
    if e.response[&#x27;Error&#x27;][&#x27;Code&#x27;] == &#x27;InvalidParameterValue&#x27;:
        print(&#x27;ERROR MESSAGE: {}&#x27;.format(e))&quot;
if [ $? -eq 0 ]; then
    sudo reboot
fi
</code></pre><ol type="1" id="3f5d8438-dfce-4060-8c34-a3a15a2f9f95" class="numbered-list" start="11"><li>Clone the secure sagemaker studio repository to your local workspace with this command </li></ol><pre id="e8bd9669-8109-4022-8ee9-a725d5a6b932" class="code"><code>cd ~/environment
git clone https://github.com/aws-samples/amazon-sagemaker-studio-secure-data-science-workshop.git
</code></pre><hr id="05abd0ee-1c18-449f-9e77-b3493fc6f6df"/><h2 id="a843a9dc-aae7-4e1a-bf74-ce4914b84fef" class=""><strong>Lab 1: Best Practice as Code</strong></h2><h3 id="574880dc-1c18-4a5b-8921-306aefbbaa03" class=""><strong>Upload CloudFormation templates to S3 bucket in your account:</strong></h3><p id="3bfaba36-61e0-40e1-9392-9825a3f69b70" class="">Use Cloud9 bash shell to execute the steps below:</p><ol type="1" id="07349837-7515-4e1a-bcf8-4be1aa469d77" class="numbered-list" start="1"><li>Move to secure sagemaker studio repository directory.</li></ol><pre id="d1cd0ae7-4218-4e79-a951-b73df1812c45" class="code"><code>cd ~/environment/amazon-sagemaker-studio-secure-data-science-workshop</code></pre><ol type="1" id="31f1df44-0ebf-4487-a951-dc47b702c531" class="numbered-list" start="2"><li>Check that AWS_DEFAULT_REGION, AWS_ACCOUNT_ID environment variables are set in your Cloud9 bash shell, these environment variables were configured in <code>Prerequisites</code> section for <code>Cloud9 Setup</code>. If any of the variable are not set, run command in Prerequisites step 9.</li></ol><pre id="544716b1-6ab0-473c-85d0-f4052ab7f85a" class="code"><code>echo $AWS_DEFAULT_REGION
echo $AWS_ACCOUNT_ID</code></pre><ol type="1" id="a495f734-0d91-4a4f-bd0d-ae920b318d70" class="numbered-list" start="3"><li>Upload cloudformation templates to S3 bucket in the target region.</li></ol><pre id="988a2be7-df71-418e-873e-f413a61b8aa6" class="code"><code>./package_cloudformation.sh</code></pre><ol type="1" id="08f25b39-18b2-4dfb-bf23-0101b0b5ef34" class="numbered-list" start="4"><li>As <strong>Cloud Platform Engineering</strong> team member with AWS Administration role, you will now deploy the Shared Service infrastructure. When the script is done, it will <strong>print a command</strong> to run create-stack using <code>ds_administration.yaml</code> template. <strong>Copy the printed command in previous step </strong>and run it, it will look like this:</li></ol><pre id="ac90a82e-e544-466a-8628-89a921a3a1f7" class="code"><code>aws cloudformation create-stack \
   --template-url https://s3.${REGION}.amazonaws.com/${CFN_BUCKET_NAME}/${PROJECT_NAME}/ds_administration.yaml \ 
   --region ${REGION} 
   --stack-name secure-ds-shared-service \
   --capabilities CAPABILITY_NAMED_IAM \
   --parameters ParameterKey=QuickstartMode,ParameterValue=true</code></pre><ol type="1" id="245e6eb9-62d4-4709-8c52-73ba8746bde1" class="numbered-list" start="5"><li>Visit CloudFormation console in AWS Management Console. Click on <code>Stacks</code> link in left navigation bar. Click on <code>secure-ds-shared-service</code>  in the list of <code>Stacks</code> in the main window. Wait until the Status becomes <mark class="highlight-teal">CREATE_COMPLETE</mark>. It will takes around 10-15 minutes.<figure id="1c89ac85-955d-4afc-8e6f-a29fe965e426" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.09.54_PM.png"><img style="width:2802px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.09.54_PM.png"/></a></figure></li></ol><h3 id="80b50a10-64de-4d24-8c8d-9e27db76ff46" class=""><strong>Upload Dataset to the S3 data lake bucket</strong></h3><ol type="1" id="ea333817-90af-4207-82a8-693523d17da5" class="numbered-list" start="1"><li>Visit S3 console in AWS Management Console. You will notice the S3 bucket simulating Data Lake is created for you: <code>ds-data-lake-xxxxxxxxxx</code><figure id="5f542335-d2a1-4f34-81b5-4998a1239d6f" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.26.45_PM.png"><img style="width:3274px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.26.45_PM.png"/></a></figure></li></ol><ol type="1" id="eae7deeb-1b3b-400b-a16f-b100c35d0360" class="numbered-list" start="2"><li>Use Cloud9 bash shell to execute the steps below: Download the <code>Credit Card default dataset</code> and Upload the dataset to S3 Data Lake bucket:</li></ol><pre id="f38ce562-fb2f-462e-9092-87524c91c80f" class="code"><code>curl -o credit_card_default_data.xls https://archive.ics.uci.edu/ml/machine-learning-databases/00350/default%20of%20credit%20card%20clients.xls
export S3_DATA_LAKE=`aws s3 ls | grep ds-data-lake- | awk &#x27;{print $3}&#x27;`
aws s3 cp credit_card_default_data.xls s3://${S3_DATA_LAKE}/secure-sagemaker-demo/credit-card-default/credit_card_default_data.xls</code></pre><ol type="1" id="3dd58bac-97dc-4101-ba5f-3154f35383e7" class="numbered-list" start="3"><li>In S3 console, click on bucket starting from <code>ds-data-lake</code> in the list of <code>Buckets</code> in the main window. Then click <code>secure-sagemaker-demo/</code> → <code>credit-card-default/</code> and check if the sample dataset <code>credit_card_default_data.xls</code> for later machine learning training job exists.<figure id="c175d958-cb36-4835-aa30-7c42a871213e" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.11.07_PM.png"><img style="width:2780px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.11.07_PM.png"/></a></figure></li></ol><h3 id="b82084ba-bb48-4d81-b5b6-c295aeb9393a" class=""><strong>Install approved Python packages in Code Artifact repository</strong></h3><ol type="1" id="d66bd874-1b80-4b1b-8f38-f0c629eb78e9" class="numbered-list" start="1"><li>Visit CodeArtifact console in AWS Management Console. Once there, click on <code>Repositories</code> link in left navigation bar. You will notice two repositories created for you: <code>ds-public-upstream-repo</code> and <code>ds-shared-repo</code><figure id="0679e2dd-791b-4d61-ad4a-ea5ffdf3a565" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/code-artifact-repositories.png"><img style="width:3014px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/code-artifact-repositories.png"/></a></figure></li></ol><ol type="1" id="9a0b354a-0846-4a60-a3de-3e6a7747916b" class="numbered-list" start="2"><li>Click on <code>ds-public-upstream-repo</code> in the list of <code>Repositories</code> in the main window. This is the data science shared CodeArtifact upstream repository with <a href="https://docs.aws.amazon.com/codeartifact/latest/ug/external-connection.html">external connection </a>between a CodeArtifact repository and an external public repository like <a href="https://pypi.org/">PyPI </a>. Other Code Artifact repositories use it as their upstream repository.<figure id="486f7f73-5bfc-457e-8a31-ff25cb3036e5" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/code-artifact-repository-external-connection.png"><img style="width:3016px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/code-artifact-repository-external-connection.png"/></a></figure></li></ol><ol type="1" id="362e10ae-57ed-4bbd-b04a-a71376a286cc" class="numbered-list" start="3"><li>Click on <code>ds-shared-repo</code> in the list of <code>Repositories</code> in the main window. This is the data science shared CodeArtifact repository for hosting Python packages. Notice the Python packages under <code>Packages</code> section. It should be empty. In this lab you will install approved Python packages in this shared CodeArtifact PyPI repository.<figure id="e416aaf1-c662-4f7f-be0a-77530bd19525" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/code-artifact-repository-shared-empty.png"><img style="width:3028px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/code-artifact-repository-shared-empty.png"/></a></figure></li></ol><ol type="1" id="13a0ac6e-665e-4c48-b10c-37f7ba2839fd" class="numbered-list" start="4"><li>Now it is time to <strong>install approved Python packages in the shared CodeArtifact repository</strong>. Execute the commands below to run <code>install_code_artifact_pip_packages.sh</code>
in the Cloud9 bash terminal tab.</li></ol><pre id="bd6a7130-f9e5-4b4a-bcee-239e94e8f6cb" class="code"><code>cd ~/environment/amazon-sagemaker-studio-secure-data-science-workshop
./code_artifact_login.sh 
./install_code_artifact_pip_packages.sh</code></pre><ol type="1" id="00971959-481e-48f3-b4f2-eda939c8309f" class="numbered-list" start="5"><li>In Code Artifact console, visit <code>ds-shared-repo</code> again. Notice the Python packages under <code>Packages</code> section.<figure id="913fd412-13ad-4975-a9dc-f93fc5378cdc" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/code-artifact-packages.png"><img style="width:3018px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/code-artifact-packages.png"/></a></figure></li></ol><ol type="1" id="fb697fd1-1cdb-4bb4-b1f9-c68ba11ae31a" class="numbered-list" start="6"><li>Visit <code>ds-public-upstream-repo</code>, you will find the external connection to public PyPI has been disassociated. Examine the script <code>install_code_artifact_pip_packages.sh</code>
 used earlier, you will notice that the last command is to dis-associate external connection.<figure id="0494c277-e07d-4562-badf-2ff7b21f1953" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.22.03_PM.png"><img style="width:3248px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.22.03_PM.png"/></a></figure></li></ol><h3 id="b74eb767-7a40-4dbe-ad22-f495cd149735" class=""><strong>Build a custom SageMaker image and upload to Amazon Elastic Container Registry (ECR) repository</strong></h3><ol type="1" id="be92e804-8d68-4f2d-9c62-daaadd0dc5e5" class="numbered-list" start="1"><li>Visit ECR console in AWS Management Console. Once there, click on <code>Repositories</code> link in left navigation panel under <code>Amazon ECR</code> section. You will notice <code>ds-shared-container-images</code> in the list of Repositories in the <strong>Private</strong> tab of main window. This is the data science shared ECR repository for hosting custom docker images for SageMaker Studio notebook kernel.<figure id="349a971a-228f-4ecb-a9b2-780e333b043a" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.18.56_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.18.56_PM.png"/></a></figure></li></ol><ol type="1" id="6c733601-aa00-4071-a8e3-b83756960541" class="numbered-list" start="2"><li>In this step, you will build a custom SageMaker image and upload to ECR repository created earlier. You will use the custom image to configure and setup environment for SageMaker Studio notebook. Execute the commands below in the Cloud9 bash terminal tab.</li></ol><pre id="38ead56a-ba41-4179-bcc2-dc9419501d9d" class="code"><code>cd ~/environment/amazon-sagemaker-studio-secure-data-science-workshop
cd customimage/jupyter-docker-stacks-tensorflow
./build-publish-sm-docker-image.sh</code></pre><ol type="1" id="aa35e1f4-9600-49b6-a66b-0560aecff96d" class="numbered-list" start="3"><li>In ECR console in AWS Management Console, click on <code>ds-shared-container-images</code> in the list of Repositories in the <strong>Private</strong> tab of main window. Notice the custom SageMaker docker image named <code>ds-custom-tensorflow241</code> under <code>Images</code> that you built and pushed in previous step.<figure id="9167d93d-3155-4a6b-9bc4-3419a2b8a8dd" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/ecr-repository.png"><img style="width:3008px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/ecr-repository.png"/></a></figure></li></ol><ol type="1" id="544cffc9-58f5-4705-92e8-794d0c006176" class="numbered-list" start="4"><li>Click <code>Copy URI</code> under Image URI column and keep it somewhere. You will need this URI in <strong>Lab 2 - Onboard SageMaker Studio Domain. </strong>It will look like this: <code>498837141906.dkr.ecr.ap-southeast-1.amazonaws.com/ds-shared-container-images:ds-custom-tensorflow241</code></li></ol><hr id="3ff22825-371f-49cb-b794-7b382520aec2"/><h2 id="93968239-671c-4c81-af3e-bba959a6a9b0" class=""><strong>Lab 2: Secure SageMaker Studio Domain</strong></h2><h3 id="c7128dda-c8b4-483a-8827-69c818a0fa7e" class="">Assume Data Science Admin Role</h3><ol type="1" id="c80b1800-34d6-432e-bcd5-2d41391bfa01" class="numbered-list" start="1"><li>Visit IAM console in AWS Management Console. Once there, click on <code>Roles</code> link in left navigation panel. Type <code>DSSharedServices</code> in search bar under the list of Roles in the main window. You will notice three IAM roles created for you:<figure id="71592a10-5745-483f-a7ea-9a80b25729b7" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.39.53_PM.png"><img style="width:3278px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.39.53_PM.png"/></a></figure></li></ol><ol type="1" id="b8377a82-bd12-4986-afd3-5c57ca74301c" class="numbered-list" start="2"><li>Click Role name starting from <code>DSSharedServices-DataScienceAdministrator</code>. Under Summary section, copy the <strong>Link to switch roles in console</strong>. <figure id="5126b396-7f71-4570-a556-76d494e1a3b9" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.41.05_PM.png"><img style="width:3246px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.41.05_PM.png"/></a></figure></li></ol><ol type="1" id="5b2015d7-e477-48f2-9ed3-24d7589862ec" class="numbered-list" start="3"><li>Browse the copied link and click <strong>Switch Role</strong>. You will now access the AWS Account as Data Science Admin Role.<figure id="2303a772-95c0-4d6a-a8e2-260eeaff075e" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.42.29_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.42.29_PM.png"/></a></figure></li></ol><h3 id="f4b56be5-170e-433a-a928-d3ec4ca89749" class="">Onboard SageMaker Studio Domain</h3><ol type="1" id="75af81e2-7a73-4ad1-b106-b06edb397b76" class="numbered-list" start="1"><li>Visit the AWS Service Catalog console in AWS Management Console. Once there, click on <code>Products</code> link in left navigation panel under <code>Provisioning</code> section. You will notice three Service Catalog Products created for you: <code>SageMaker Studio Product</code>, <code>Data Science Team Environment</code> and <code>Data Science Studio User Profile</code>.<figure id="01650faa-f313-4613-958e-97d9fc914302" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.47.03_PM.png"><img style="width:3278px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.47.03_PM.png"/></a></figure></li></ol><ol type="1" id="8ce499b4-9ea5-4603-ae12-056b745a1dbc" class="numbered-list" start="2"><li>Check the radio button on the left of product <code>SageMaker Studio Product</code> and click <code>Launch product</code> button. <figure id="45dc08f5-3a52-4a21-bb9b-07297a51c675" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.59.19_PM.png"><img style="width:3278px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.59.19_PM.png"/></a></figure></li></ol><ol type="1" id="46a7b859-1dda-43f2-8c80-46b2440161b3" class="numbered-list" start="3"><li>Give the <code>Provisioned product name</code>, the name must be unique, to make it easy to generate a unique name check the box <code>Generate name</code>:<figure id="b2580a45-add1-45d0-aed0-1e7e52e47032" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.48.09_PM.png"><img style="width:1806px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.48.09_PM.png"/></a></figure></li></ol><ol type="1" id="1c3ab790-fff1-4bad-805d-38e32ef66a7d" class="numbered-list" start="4"><li>In Product versions section, <code>DS SageMaker Studio v1</code> should be already selected.</li></ol><ol type="1" id="db1d8f90-6546-4d52-977b-83b9e84df971" class="numbered-list" start="5"><li>Provide values for following parameters:<ol type="a" id="61c6dee5-7103-4d10-90fb-8e43c742d2ef" class="numbered-list" start="1"><li>AppImageConfigName: <code>ds-tensorflow241-image-config</code></li></ol><ol type="a" id="7c37ad4f-fbbf-41c3-ac08-3cd76550ddca" class="numbered-list" start="2"><li>CustomImageDescription: <code>Custom TensorFlow v2.4.1 Image</code></li></ol><ol type="a" id="5d399872-3898-44ae-ad10-4ad5385efb1e" class="numbered-list" start="3"><li>CustomImageEcrUri: obtain Image URI copied in <strong>Lab 1 - Build a custom SageMaker image and upload to Amazon Elastic Container Registry (ECR) repository </strong>Step 4.</li></ol><ol type="a" id="201b2c78-32a4-414e-a97c-15656d49cfd3" class="numbered-list" start="4"><li>CustomImageName: <code>ds-custom-tensorflow241</code></li></ol><ol type="a" id="aa2da1e2-d6a2-418b-bf6c-5d7766464e41" class="numbered-list" start="5"><li>KMSAlias: <code>ds-sagemaker-studio-kms</code></li></ol><ol type="a" id="db3d8ae7-a16d-4c23-9548-b6161e616604" class="numbered-list" start="6"><li>KernelSpecsDisplayName: <code>Python3 TensorFlow 2.4.1</code></li></ol><ol type="a" id="c3aa1029-fa55-40ec-902b-39ffa5abd20d" class="numbered-list" start="7"><li>KernelSpecsName: <code>python3</code></li></ol><ol type="a" id="58b7c0a1-1dff-4333-baa3-8b1df87025b3" class="numbered-list" start="8"><li>SharedServiceStackSetName: <code>DSSharedServices</code>.</li></ol><ol type="a" id="19c58b07-2c11-460b-98de-09f5641d0ab3" class="numbered-list" start="9"><li>StudioDomainName: <code>ds-studio-domain</code> (this is default)<figure id="1634614b-9daa-4531-bf93-d16c98c9dea4" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.55.19_PM.png"><img style="width:1714px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.55.19_PM.png"/></a></figure></li></ol></li></ol><ol type="1" id="027063b9-4294-4c86-b24e-47f4b58e8d51" class="numbered-list" start="6"><li>Click <code>Launch product</code>. It will take around 10-15 minutes for the stack to complete onboarding of SageMaker Studio Domain. Click <code>Provisioned products</code> link in left navigation panel under <code>Provisioning</code> section, you will notice the products is launching. Wait until the Status becomes <mark class="highlight-teal">Available</mark>.<figure id="0ca9b2a2-b682-433b-acac-dbdbe77e2844" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.03.58_PM.png"><img style="width:3278px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.03.58_PM.png"/></a></figure></li></ol><hr id="320ae377-a92d-49ed-9de6-c7c77f97cf1d"/><h2 id="ebfc7a78-ed9d-421b-bac3-173327b181d6" class="">Lab 3 - Secure Team Environment</h2><h3 id="28bb73ef-51df-42ef-a304-d3f6df246eed" class="">Deploy a data science environment</h3><ol type="1" id="fc3ba151-7b41-4cd7-805d-9b14bdb0bb3f" class="numbered-list" start="1"><li>Continue as Data Science Admin Role (<strong>Lab 2 - Assume Data Science Admin Role</strong>).</li></ol><ol type="1" id="ae603a36-accf-43bf-a21a-b600e84a3faf" class="numbered-list" start="2"><li>In AWS Service Catalog console, check the radio button on the left of product <code>Data Science Team Environment</code> and click <code>Launch product</code> button. <figure id="d6a114e4-d1b3-4088-8daa-5717d58162b4" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.59.33_PM.png"><img style="width:3276px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_7.59.33_PM.png"/></a></figure></li></ol><ol type="1" id="476f80bb-3f71-4174-bddb-8376bc23dff7" class="numbered-list" start="3"><li>Give the <code>Provisioned product name</code>, the name must be unique, to make it easy to generate a unique name check the box <code>Generate name</code>:<figure id="e3a12de3-8a0e-42ad-8d28-453e81c8e282" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.01.05_PM.png"><img style="width:1828px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.01.05_PM.png"/></a></figure></li></ol><ol type="1" id="c8a94a37-f469-44a5-a376-92928ed5a4ec" class="numbered-list" start="4"><li>In Product versions section, <code>DS Environment v1</code> should be already selected.</li></ol><ol type="1" id="08657727-b2ce-4240-b95c-b75f77a1da64" class="numbered-list" start="5"><li>Provide values for following parameters:<ol type="a" id="6545ea94-a4dc-4ba8-b281-2c31d8e4646e" class="numbered-list" start="1"><li>EnvType: <code>dev</code> (this is default)</li></ol><ol type="a" id="0353ded1-b270-4cbd-972f-c177b4273e21" class="numbered-list" start="2"><li>SharedServiceStackSetName: <code>DSSharedServices</code> </li></ol><ol type="a" id="aa5b4e0c-3a91-49f8-9fa4-7ecc1586179b" class="numbered-list" start="3"><li>TeamName: <code>ex</code> (<mark class="highlight-yellow_background">Please keep within 2 characters in this lab</mark>)<figure id="8c8a6efc-358d-417f-ac3b-c782cfc71bee" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.14.52_PM.png"><img style="width:2330px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.14.52_PM.png"/></a></figure></li></ol></li></ol><ol type="1" id="182297d0-3fbe-49e8-92f0-43a5f247ffa6" class="numbered-list" start="6"><li>Click <code>Launch product</code>. It will take around 5-7 minutes for the stack to complete onboarding of SageMaker Studio Domain. Click <code>Provisioned products</code> link in left navigation panel under <code>Provisioning</code> section, you will notice the products is launching. Wait until the Status becomes <mark class="highlight-teal">Available</mark>.<figure id="e55af188-a4d4-4062-b06c-8a7c69f789da" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.10.23_PM.png"><img style="width:3278px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.10.23_PM.png"/></a></figure></li></ol><h3 id="dd50d13b-1b43-4835-86b5-f4c4dbe12eca" class=""><strong>Create SageMaker Studio Domain users for a data science environment</strong></h3><ol type="1" id="f13597d8-e87f-4868-9958-0f3d66e44494" class="numbered-list" start="1"><li>Continue as Data Science Admin Role (<strong>Lab 2 - Assume Data Science Admin Role</strong>).</li></ol><ol type="1" id="690ae033-470a-4905-a4f8-88a85f9283f5" class="numbered-list" start="2"><li>In AWS Service Catalog console, check the radio button on the left of product <code>Data Science Studio User Profile</code> and click <code>Launch product</code> button. <figure id="195c20b1-a9f1-48da-8b99-61bb4044000b" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.06.48_PM.png"><img style="width:3274px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.06.48_PM.png"/></a></figure></li></ol><ol type="1" id="0824d8b6-42ab-4b84-ab45-e6c5071fc093" class="numbered-list" start="3"><li>Give the <code>Provisioned product name</code>, the name must be unique, to make it easy to generate a unique name check the box <code>Generate name</code>:<figure id="bd3e33cd-9590-4381-af73-b6bfce254511" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.11.43_PM.png"><img style="width:1834px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.11.43_PM.png"/></a></figure></li></ol><ol type="1" id="96ac66ab-f96a-45b6-ad2b-05a4a7920bde" class="numbered-list" start="4"><li>In Product versions section, <code>DS SageMaker Studio User Profile v1</code> should be already selected.</li></ol><ol type="1" id="cf517a65-a91b-4f9d-9561-f7e5b5803078" class="numbered-list" start="5"><li>Provide values for following parameters:<ol type="a" id="f938ef28-e93c-4cff-9d92-d73f12b34e31" class="numbered-list" start="1"><li>SharedServiceStackSetName: <code>DSSharedServices</code> </li></ol><ol type="a" id="34278d77-3adc-4d6b-b1d1-a493bf25d842" class="numbered-list" start="2"><li>TeamName: <code>ex</code> (Map to value set in <strong>Lab 3 - Deploy a data science environment</strong>)</li></ol><ol type="a" id="23228d6a-88a1-40c8-896c-cc4c96c1c6e4" class="numbered-list" start="3"><li>EnvType: <code>dev</code> (Map to value set in <strong>Lab 3 - Deploy a data science environment</strong>)</li></ol><ol type="a" id="cdb378ce-de69-4a66-8526-c021dce31397" class="numbered-list" start="4"><li>StudioUserProfileName: <code>riskmodeler</code>, this is the new user profile name that you are on-boarding to a data science team.<figure id="23d4b225-0bf2-4a84-8e59-58aa33f586d1" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.13.52_PM.png"><img style="width:2088px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.13.52_PM.png"/></a></figure></li></ol></li></ol><ol type="1" id="a6aa468c-48ff-4143-8e8a-8cebfa6b909b" class="numbered-list" start="6"><li>Click <code>Launch product</code>. It will take around 1-2 minutes for the stack to complete onboarding of SageMaker Studio Domain. Click <code>Provisioned products</code> link in left navigation panel under <code>Provisioning</code> section, you will notice the products is launching. Wait until the Status becomes <mark class="highlight-teal">Available</mark>.<figure id="28df51ff-bc96-4358-989e-6e644741a5b9" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.16.48_PM.png"><img style="width:3276px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.16.48_PM.png"/></a></figure></li></ol><hr id="adc0fa5e-f27a-4d01-b015-e5ae66301d0b"/><h2 id="00490fe7-8640-4c68-826b-5dbc47701eab" class="">Lab 4 - Launch SageMaker Studio IDE</h2><h3 id="bc2b1b9e-9723-4253-ae97-afc959480b06" class="">Assume Data Science User Role</h3><ol type="1" id="13b9c7c0-e657-4ac2-a386-1662fe85ea8d" class="numbered-list" start="1"><li>In AWS Service Catalog console, click on <code>Provisioned products</code> link in left navigation panel under <code>Provisioning</code> section. You will notice three provisioned products created in Lab 2 and 3. Click the product name starting with <code>Data_Science_Team_Environment</code>. Scroll down and in the <strong>Events</strong> tab of main window, find the Output key <code>AssumeDataScientistUserRole</code> and click the corresponding Output value.<figure id="0147d7fc-58a5-4f4a-9f64-29f4efd2ec96" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.22.21_PM.png"><img style="width:3258px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.22.21_PM.png"/></a></figure></li></ol><ol type="1" id="dbc7d62a-d6bc-47a4-8050-98eee5f281c3" class="numbered-list" start="2"><li>In the assume role page, click <strong>Switch Role</strong>. You will now access the AWS Account as Data Science User Role.<figure id="3ca6dcd3-0092-4f4f-9f13-80108094faed" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.23.17_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.23.17_PM.png"/></a></figure></li></ol><h3 id="c51915cd-b73b-4d03-8607-3cd3e2ecbac2" class="">Launch SageMaker Studio IDE</h3><ol type="1" id="701e4ca8-3416-4c96-acfa-587dfcba9812" class="numbered-list" start="1"><li>Visit the SageMaker console in AWS Management Console. Click on <code>Control panel</code> link in the left navigation panel to visit <code>SageMaker Studio Control Panel</code>. <figure id="39b04efa-ec16-45fd-a84a-d0190357793d" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.50.25_PM.png"><img style="width:3326px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.50.25_PM.png"/></a></figure></li></ol><ol type="1" id="8614da1f-8913-41fa-8f23-36a65fb57354" class="numbered-list" start="2"><li>Scroll down in the main windows. You will notice the custom docker images for SageMaker Studio notebook kernel built and uploaded to ECR in <strong>Lab 1 - Build a custom SageMaker image and upload to Amazon Elastic Container Registry (ECR) repository </strong>is attached to SageMaker Domain.<figure id="f5378da0-10ed-4819-8850-4e9306daa211" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.52.43_PM.png"><img style="width:2026px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.52.43_PM.png"/></a></figure></li></ol><ol type="1" id="2eeeecf7-7c6d-4b39-829e-062956f2986e" class="numbered-list" start="2"><li>Click on Launch app → Studio for the user created in previous step. This will launch the SageMaker Studio IDE.<figure id="b5f6ab59-7742-4a56-a6db-84e4fb54060d" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.27.07_PM.png"><img style="width:3324px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.27.07_PM.png"/></a></figure></li></ol><ol type="1" id="dd2285f4-7748-42f3-9f59-f4278f31f561" class="numbered-list" start="3"><li>SageMaker service will prepare your Studio environment by starting the Jupyter Server app on first access. It can take 5-10 minutes. Subsequent Studio launches take a few seconds since Studio environment is already prepared for use.<figure id="1b7d0489-5b6f-480d-9080-85dcafc284b1" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.27.23_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.27.23_PM.png"/></a></figure></li></ol><ol type="1" id="fd20503d-c515-4b86-9286-a656113f1ac5" class="numbered-list" start="4"><li>SageMaker Studio when launched will open the <code>Launcher</code> screen in the main window.<figure id="9e454340-00e0-4b84-bb5b-816ff22e5584" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.28.21_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.28.21_PM.png"/></a></figure></li></ol><h3 id="dc6ebce3-48fc-4daa-b35b-19d318e5babb" class="">Clone Git Repository to SageMaker Studio</h3><ol type="1" id="eadac43d-1a48-435e-a1a6-c938bfedab9f" class="numbered-list" start="1"><li>Visit CodeCommit console in AWS Management Console. Once there, click on <code>Repositories</code> link in left navigation bar. You will notice the Data Science Team Git repositories created for you: <code>ds-source-{TeamName}-{EnvType}</code><figure id="c6540534-1f3b-4f84-964a-51c267e6de60" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.32.05_PM.png"><img style="width:3276px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.32.05_PM.png"/></a></figure></li></ol><ol type="1" id="2a04cc82-69c8-4509-a092-8653a30189aa" class="numbered-list" start="2"><li>Click on <code>ds-source-{TeamName}-{EnvType}</code> in the list of <code>Repositories</code> in the main window. Check if the sample notebook files exist. We will use demo notebook <code>00_SageMaker-SysOps-Workflow.ipynb</code> in the rest of the labs.<figure id="f8e2b1ce-836f-4229-a2af-d212f66439b8" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.32.54_PM.png"><img style="width:3278px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.32.54_PM.png"/></a></figure></li></ol><ol type="1" id="c2b2317c-7b42-46b0-b1a4-45c5c988994d" class="numbered-list" start="3"><li>Click Clone URL → Clone HTTPS to copy the Git remote URL. This will look like: <code>https://git-codecommit.ap-southeast-1.amazonaws.com/v1/repos/ds-source-{TeamName}-{EnvType}</code><figure id="890048e6-4816-4971-98a0-5a55ab33c783" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.34.10_PM.png"><img style="width:2642px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.34.10_PM.png"/></a></figure></li></ol><ol type="1" id="b35e74ad-bda3-45cb-93ba-246e7efeea6b" class="numbered-list" start="4"><li>Back to SageMaker Studio IDE. Click the <strong>Git icon</strong> in the left navigation bar and click <strong>Clone a Repository</strong>.<figure id="e29071d6-16e8-4ba3-b7fe-aa2d4cb3ce15" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.36.14_PM.png"><img style="width:792px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.36.14_PM.png"/></a></figure></li></ol><ol type="1" id="b6325b6d-2e01-45d3-b4cd-12f55a898cff" class="numbered-list" start="5"><li>Copy the Git remote URL captured in step 3 and click <strong>CLONE</strong>.<figure id="aa309a12-9371-46d0-8a6b-5cbafb9d5227" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.39.01_PM.png"><img style="width:774px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.39.01_PM.png"/></a></figure></li></ol><ol type="1" id="43fbfead-ea98-40cd-ac38-7c48eac6a49b" class="numbered-list" start="6"><li>You will notice the Data Science Team Git repository has been cloned to your local repository.<figure id="67708b1c-7e72-44c1-9dcb-607d657f580c" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.40.16_PM.png"><img style="width:792px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.40.16_PM.png"/></a></figure></li></ol><h3 id="f0009dd3-b84f-40ae-bb58-00ee28078fa8" class=""><strong>Configure SageMaker Studio Notebook Environment</strong></h3><ol type="1" id="824dae1c-877b-4ec7-a4b9-3fa7b31e44b3" class="numbered-list" start="1"><li>In Studio <code>Launcher</code> go to <code>Notebooks and compute resources</code> section. In <code>Select a SageMaker image</code> choose <code>ds-custom-tensorflow241</code> image:<figure id="1b307c2a-d1ca-485a-962f-d1961d54ce2d" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/studio-notebook-select-custom-image.png"><img style="width:3042px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/studio-notebook-select-custom-image.png"/></a></figure></li></ol><ol type="1" id="e54ce06b-2cf5-4dac-b276-420c6bd40c7c" class="numbered-list" start="2"><li>Launch a notebook instance by clicking on + icon. This will launch notebook instance in a new IDE tab. SageMaker service will start a Jupyter Kernel Gateway App instance, it can take 4-6 minutes for the kernel gateway app to start.<figure id="8ef42ffe-f6c0-48f6-b68f-42149ada5722" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/studio-notebook-launch.png"><img style="width:3046px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/studio-notebook-launch.png"/></a></figure></li></ol><ol type="1" id="2dbc7ca9-f265-4123-86f4-6773ddc9523b" class="numbered-list" start="3"><li>After kernel gateway start, Click the <code>top second icon</code> in the left navigation bar. You will notice the running compute resources in SageMaker Studio, and the kernel sessions running on the compute resources. You can verify the Kernel CPU and Memory states on the top right of the notebook.<figure id="4afcebe6-54e1-4f71-96c2-a06a26bbec3e" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Untitled.png"><img style="width:1922px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Untitled.png"/></a></figure></li></ol><ol type="1" id="c7f2ebfc-2733-4d29-bce8-ac28a34539cf" class="numbered-list" start="3"><li>Launch image terminal (bash terminal) into the docker container for the notebook instance by clicking on <code>$_</code> icon in notebook toolbar at the top. This will launch a bash shell terminal in a new IDE tab. <figure id="2b58791e-5f9a-4861-a255-1987841f4d60" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/studio-notebook-image-terminal-launch.png"><img style="width:3032px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/studio-notebook-image-terminal-launch.png"/></a></figure></li></ol><ol type="1" id="af9a07a9-802a-4ded-a250-0e4c9a778bad" class="numbered-list" start="4"><li>In the shell prompt you will now set up the <strong>data science environment</strong> by creating <code>sagemaker_environment.py</code>file and placing it in local Git repository <code>ds-source-{TeamName}-{EnvType}</code>. When Studio notebook image terminal shell is launched, you will be in <code>/home/jovyan/work</code> directory which is mapped to your home directory in EFS volume by SageMaker Studio.<figure id="3302907e-92d1-4487-812d-8410471ac341" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/studio-notebook-image-terminal.png"><img style="width:3038px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/studio-notebook-image-terminal.png"/></a></figure></li></ol><ol type="1" id="232d34f3-cb97-41fb-bd3a-5fbe736c0a80" class="numbered-list" start="5"><li>Run the following code to execute the steps below: </li></ol><pre id="74894789-ec43-41e4-b068-dc90ee3f5081" class="code"><code>cd ~/bin
sed -i &#x27;s/TEAM_NAME=fsi-smteam/TEAM_NAME=ex/g&#x27; setup-ds-env.sh
chmod +x *.sh
cp -r $HOME/bin $HOME/work
./setup-ds-env.sh
cp $HOME/.ipython/sagemaker_environment.py $HOME/work/ds-source-ex-dev</code></pre><ul id="e8a57b8e-a77c-4704-8b90-d049591de616" class="bulleted-list"><li style="list-style-type:disc">Builds SageMaker convenience module <code>sagemaker_environment.py</code> for retrieving secure environment parameters (VPC subnet, security group, KMS key, S3 bucket) and places it in cloned Git repository directory<code>$HOME/work/ds-source-{TeamName}-{EnvType}</code>.</li></ul><ul id="57a2feb6-84e7-4c7b-a27d-31d855c86093" class="bulleted-list"><li style="list-style-type:disc">TeamName and EnvType must map to the value set in <strong>Lab 3 - Deploy a data science environment</strong></li></ul><ul id="fad128f6-c824-4884-a19b-d2c2ceb5cea0" class="bulleted-list"><li style="list-style-type:disc"><code>code-artifact-login.sh</code> is internally in <code>setup-ds-env.sh</code>to configure pip to use shared CodeArtifact repository  script. It is provided so that you can renew <strong>AWS CodeArtifact authentication token</strong> which is valid only for 12 hours. Use this script to obtain a new token when the token expires.</li></ul><p id="90a675e7-e55f-487d-9182-7c1e93fe880f" class="">This script is required to be executed only once after startup of Kernel Gateway App (docker instance) and as along as kernel gateway is running SageMaker environment is configured.</p><hr id="e3240cba-4403-49ad-86d8-fad6e7536310"/><h2 id="7f56945e-6ed6-4b85-8b3e-8efb85928a8d" class="">Lab 5 - Detective and Corrective Controls</h2><h3 id="2729bfc7-33a3-4df8-82bf-7f22345beb37" class="">Environment Setup for the Demo Notebook</h3><ol type="1" id="9dfba99d-d0ac-4296-9f9f-05555f6ce71d" class="numbered-list" start="1"><li>In SageMaker Studio IDE, double click the cloned Git repository directory <code>ds-source-{TeamName}-{EnvType}</code>. You will notice the sample notebooks are cloned from CodeCommit local environment. <figure id="141618d8-5379-44e1-9f7a-0e434c5fe85c" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_9.29.46_PM.png"><img style="width:790px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_9.29.46_PM.png"/></a></figure></li></ol><ol type="1" id="a63c80a9-e008-4f5a-9a7e-6b9ab18a0e3d" class="numbered-list" start="2"><li>Open demo notebook <code>00_SageMaker-SysOps-Workflow.ipynb</code>. The <strong>Set up notebook environment</strong> is prompted out. Select custom image <code>ds-custom-tensorflow241</code> and click <strong>Select</strong>.<figure id="77880100-01c2-4de4-86e9-833c964232af" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.45.23_PM.png"><img style="width:1368px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_8.45.23_PM.png"/></a></figure></li></ol><ol type="1" id="6bcb357f-ee20-4269-8484-bc766d6262a6" class="numbered-list" start="3"><li>The demo notebook is opened in the right work area. In the upcoming sections, execute the cells<strong> </strong>by pressing <code><strong>Shift+Enter</strong></code> in each of the cells. While the code runs, an * appears between the square brackets as pictured in the first screenshot to the right. After a few seconds, the code execution will complete, the * will be replaced with the number 1.<figure id="b528e40a-4d84-4a59-8ac6-128c1ce88d10" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_9.54.04_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_9.54.04_PM.png"/></a></figure></li></ol><ol type="1" id="134ddcbf-d3d2-471e-b461-d52c1f8f7ab7" class="numbered-list" start="4"><li>In <code>Part 1: Compute and Network Isolation</code>, it proves that the notebook instance has no  access to public internet.<figure id="02047e83-f27f-49f9-adb5-b1ff7a739f37" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.03.02_PM.png"><img style="width:2442px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.03.02_PM.png"/></a></figure></li></ol><ol type="1" id="7a9c42a6-b4d3-41ad-90ef-8cb35d1a8905" class="numbered-list" start="5"><li>In <code>Part 2: Authentication and Authorization</code>, the SageMaker Studio session and role are defined. Note that the SageMaker execution role is different from Data Science User Role. This role will be used by the user&#x27;s KernelGateway app (notebook is executed by a Studio KernelGateway app hosted by Studio) to access AWS APIs. <figure id="f9a154ed-fe86-48a1-b7c5-dd8b3c5fd074" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.03.50_PM.png"><img style="width:2374px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.03.50_PM.png"/></a></figure></li></ol><ol type="1" id="df7419af-0be3-4c2d-bb37-5c70f476b5a8" class="numbered-list" start="6"><li>Also, Import Libraries using pip from <code>Code Artifact</code> and Networking definitions (VPC Id, KMS keys and security groups and subnets) from <code>sagemaker_environment.py</code>.<figure id="a24f633e-6462-4f8f-910a-2a8ab3e12259" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.06.12_PM.png"><img style="width:2360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.06.12_PM.png"/></a></figure><figure id="1bfadfa4-1db0-412c-b794-5d4880b01613" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.06.23_PM.png"><img style="width:2364px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.06.23_PM.png"/></a></figure><figure id="b4bf2be4-c93f-4ed8-888e-45f117627e5b" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.08.21_PM.png"><img style="width:2370px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.08.21_PM.png"/></a></figure><figure id="4adb44df-2f89-46f5-b915-55c0511f7515" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.09.12_PM.png"><img style="width:2356px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.09.12_PM.png"/></a></figure></li></ol><ol type="1" id="180cc3d3-3afc-4405-8e10-5116b173fcb3" class="numbered-list" start="7"><li>In <code>Part 3: Artifact Management</code>, it defines the S3 data bucket for storing training and testing data, and model bucket for storing the trained output model.<figure id="c2f97754-cc88-4ab7-9994-a0a06013981c" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.09.58_PM.png"><img style="width:2374px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.09.58_PM.png"/></a></figure></li></ol><h3 id="188f8dad-f9bb-4e58-b357-2e882fdf1d86" class=""><strong>Pre-processing and Feature Engineering</strong></h3><p id="6cee1d2a-6b8e-4a09-8af4-84311af27047" class="">This section demonstrates the capability of offloading the heavy lifting of pre-processing larger datasets in a notebook by <strong>SageMaker Processing</strong>. It provisions the underlying infrastructure, securely downloads the data from an S3 location to the processing container, runs the processing scripts, stores the processed data in an output directory in Amazon S3 and deletes the underlying transient resources needed to run the processing job. Once the processing job is complete, the infrastructure used to run the job is wiped, and any temporary data stored on it is deleted.</p><figure id="6b316309-85ae-4461-ba15-8cc0e6a66834" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Untitled%201.png"><img style="width:1216px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Untitled%201.png"/></a></figure><ol type="1" id="e3927a44-3c65-4c10-a119-693f4d5910cd" class="numbered-list" start="1"><li>In <code>Download and Import the data</code>, the sample dataset (uploaded in <strong>Lab 1 - Upload Dataset to the S3 data lake bucket</strong>)<strong> </strong>is downloaded to SageMaker Studio local environment for basic data pre-processing (Drop ID column, rename column, and move Label column to the front).<figure id="64e19972-cdb5-4c51-91cb-8798c8e19d4a" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.13.22_PM.png"><img style="width:2392px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.13.22_PM.png"/></a></figure></li></ol><ol type="1" id="fb7dde11-081a-40e2-9ffd-c7b1b547d759" class="numbered-list" start="2"><li>In <code>Preprocessing and Feature Engineering in Notebook</code>, the pre-processed data is uploaded to S3 Data Lake bucket <code>/secure-sagemaker-demo/data</code>for further pre-processing.<figure id="c2f88869-538c-4ef3-8122-97e4408d4b34" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.17.15_PM.png"><img style="width:2378px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.17.15_PM.png"/></a></figure></li></ol><ol type="1" id="0d5f8e8f-6333-4733-831b-465e9bf89fc5" class="numbered-list" start="3"><li>In <code>Write a preprocessing script (same as above)</code>, the preprocessing script file<code>preprocessing.py</code> is prepared and uploaded to S3. <code>Scikit-Learn preprocessing package</code> is used for data pre-processing (splitting train and test data, data normalisation, data standardisation) in SageMaker Processing Job. Also, the S3 paths of output train and test data from SageMaker Processing Job are defined.<figure id="311e77ac-ecfd-4aa7-aaac-d75e4c4b16c9" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.37.23_PM.png"><img style="width:2376px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.37.23_PM.png"/></a></figure><figure id="9f21a6b3-27d8-45a5-8abd-80d589571393" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.37.51_PM.png"><img style="width:2376px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.37.51_PM.png"/></a></figure></li></ol><ol type="1" id="a7dac9f8-b37b-46c0-ad55-a3b7072bb239" class="numbered-list" start="4"><li>In <code>Part 4: Data Encryption</code>, SageMaker Processing Job is defined with specifying instance type, no. of instance, Scikit-Learn framework version, IAM execution role, network config and data encryption key for the processing instance. The SageMaker Processing Job starts by <code>sklearn_processor.run</code><figure id="8f861f21-6252-4aa9-bdf5-e0b66d03c75c" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.45.54_PM.png"><img style="width:2390px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.45.54_PM.png"/></a></figure></li></ol><ol type="1" id="8e82b89e-07fa-4395-9bf5-a9fb0202a3ad" class="numbered-list" start="5"><li>Visit SageMaker console in AWS Management Console. Once there, expand <code>Processing</code> and click on <code>Processing jobs</code> link in the left navigation panel to visit <code>SageMaker Processing</code>. You will notice the processing job created in previous steps in the list of <code>Processing jobs</code> in the main window.<figure id="c08b07c9-bb6f-4c83-a761-98b6352b3880" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.49.06_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.49.06_PM.png"/></a></figure></li></ol><h3 id="5708f14b-0d70-42f4-8163-0d2e0184a6c8" class="">Model Development and Training</h3><p id="c9404dc3-ade6-4264-b527-975a5e5f8d98" class="">This section demonstrates the capability of offloading the heavy lifting of machine learning training jobs in a notebook by <strong>SageMaker Managed Training</strong>. Same as Sagemaker Processing, it provisions the underlying infrastructure, securely downloads the data from an S3 location to the training container, runs the training scripts, stores the trained model in an output directory in Amazon S3 and deletes the underlying transient resources needed to run the training job. Once the training job is complete, the infrastructure used to run the job is wiped, and any temporary data stored on it is deleted. </p><figure id="26f4701d-d51a-4122-be92-5c82005a64b4" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Untitled%202.png"><img style="width:1286px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Untitled%202.png"/></a></figure><ol type="1" id="f84168d9-47d9-4278-8af6-de9a909f1332" class="numbered-list" start="1"><li>In <code>Traceability and Auditability</code>, you will create a<code>SageMaker Experiment</code> for data scientists to track the lineage of the model from the raw data source to the preprocessing steps and the model training pipeline. With SageMaker Experiments, data scientists can compare, track and manage multiple diferent model training jobs, data processing jobs, and hyperparameter tuning jobs, retaining a lineage from the source data to the training job artifacts to the model hyperparameters and any custom metrics that they may want to monitor as part of the model training.<figure id="90bcf537-c72d-4813-92b5-7dd48c2cb4ee" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.52.30_PM.png"><img style="width:2368px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.52.30_PM.png"/></a></figure><figure id="1cfd59bd-f319-4266-bfb1-fc55ba850270" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.52.42_PM.png"><img style="width:2380px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.52.42_PM.png"/></a></figure><figure id="775780e6-7dd1-4fc2-bc9e-234d6aa17144" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.52.57_PM.png"><img style="width:2374px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.52.57_PM.png"/></a></figure></li></ol><ol type="1" id="ae13e0e6-2eca-4321-a4ef-25858f4b83b7" class="numbered-list" start="2"><li>In <code>Train Without a VPC Configured</code>, it will demonstrate the detective and corrective controls when the training job is non-compliant. The SageMaker built-in algorithm container image URL and the S3 paths of pre-processed train and test data are defined. The SageMaker Training Job is created without defining <code>network config</code> and <code>data encryption key</code> for training instance.<figure id="84d9db23-5fb8-4c12-9b9e-5e1aacc5366f" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.59.09_PM.png"><img style="width:2364px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.59.09_PM.png"/></a></figure><figure id="dda55ee3-2bc4-4f29-a057-8f639ae7b96a" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.59.17_PM.png"><img style="width:2366px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.59.17_PM.png"/></a></figure><figure id="0e3b07e5-1d66-4dca-93b9-85b47ee5a311" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.59.38_PM.png"><img style="width:2396px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_10.59.38_PM.png"/></a></figure><pre id="8bffbdeb-7847-4702-a6d9-f9e3cac7fc51" class="code"><code>INFO:sagemaker:Creating training-job with name: sagemaker-xgboost-2021-07-26-20-58-47-761

2021-07-26 20:58:48 Starting - Starting the training job...
2021-07-26 20:58:59 Starting - Launching requested ML instances...
2021-07-26 20:59:43 Starting - Preparing the instances for training............
2021-07-26 21:01:32 Downloading - Downloading input data
2021-07-26 21:01:32 Stopping - Stopping the training job
2021-07-26 21:01:32 Stopped - Training job stopped
..

WARNING:sagemaker:Job ended with status &#x27;Stopped&#x27; rather than &#x27;Completed&#x27;. This could mean the job timed out or stopped early for some other reason: Consider checking whether it completed as you expect.

Training seconds: 1
Billable seconds: 0
Managed Spot Training savings: 100.0%</code></pre></li></ol><ol type="1" id="bf5478dd-7dff-445a-92b8-7991c83d48ad" class="numbered-list" start="3"><li>Visit SageMaker console in AWS Management Console. Once there, expand <code>Training</code> and click on <code>Training jobs</code> link in the left navigation panel to visit <code>SageMaker Managed Training</code>. You will notice the training job created in previous steps in the list of <code>Trainingjobs</code> in the main window.<figure id="431ecaab-951c-44db-a901-9951cd6d4075" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.01.26_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.01.26_PM.png"/></a></figure></li></ol><ol type="1" id="4135e99e-e3ba-417d-a0ac-df84bc46df58" class="numbered-list" start="4"><li>Visit Lambda console in AWS Management Console. Once there, click on <code>Functions</code> link in the left navigation panel. You will notice the Lambda function <code>SageMakerVPCEnforcer</code>, which the training job was terminated by this Lambda function that was executed in response to a CloudWatch Event that was triggered when the training job was created.<figure id="668978c3-1477-4f4b-b03c-65e18cc51618" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.04.54_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.04.54_PM.png"/></a></figure><figure id="64049153-e474-4052-a877-70e8f8ce27a1" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.05.33_PM.png"><img style="width:3076px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.05.33_PM.png"/></a></figure></li></ol><ol type="1" id="89a437cc-b8fc-42e6-9e33-f0e4afa6b6fc" class="numbered-list" start="5"><li>Back to SageMaker Studio IDE. In <code>Train with VPC</code>, the following security configurations are added to the Training Job. </li></ol><pre id="364a37a1-2448-4942-99a6-cdb58cfe3fec" class="code"><code>subnets=subnets, # attach SageMaker resources to your VPC
security_group_ids=sec_groups,
volume_kms_key=cmk_id, # encrypt the EBS volume attached to SageMaker Training instance</code></pre><figure id="2f6e4b8f-2018-4391-9323-87898d7715e2" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.08.37_PM.png"><img style="width:2418px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.08.37_PM.png"/></a></figure><pre id="caf93dc3-03ca-40e1-9f50-4fafd4b6e2d0" class="code"><code>INFO:sagemaker.image_uris:Defaulting to the only supported framework/algorithm version: latest.
INFO:sagemaker.image_uris:Ignoring unnecessary instance type: None.
INFO:sagemaker:Creating training-job with name: cc-training-job-1627333566

2021-07-26 21:06:06 Starting - Starting the training job...
2021-07-26 21:06:29 Starting - Launching requested ML instancesProfilerReport-1627333566: InProgress
......
2021-07-26 21:07:30 Starting - Preparing the instances for training.........
2021-07-26 21:08:52 Downloading - Downloading input data...
2021-07-26 21:09:30 Training - Downloading the training image..[2021-07-26 21:09:45.464 ip-10-2-1-70.us-west-2.compute.internal:1 INFO utils.py:27] RULE_JOB_STOP_SIGNAL_FILENAME: None
[2021-07-26:21:09:45:INFO] Imported framework sagemaker_xgboost_container.training
[2021-07-26:21:09:45:INFO] No GPUs detected (normal if no gpus installed)
[2021-07-26:21:09:45:INFO] Running XGBoost Sagemaker in algorithm mode
...
...</code></pre><ol type="1" id="9cc454b0-16e2-4db4-a4df-d08e546982c6" class="numbered-list" start="6"><li>Visit SageMaker console <code>Training jobs</code>. You will notice the first non-compliant training job is <mark class="highlight-gray">Stopped</mark> and the second compliant training job is <mark class="highlight-teal">Completed</mark> in the list of <code>Trainingjobs</code> in the main window.<figure id="11159e90-edea-4f47-99a0-3a245bc82cba" class="image"><a href="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.13.43_PM.png"><img style="width:3360px" src="Secure%20Data%20Science%20with%20Amazon%20SageMaker%20Studio%20W%2042a6ddbbf808498ea21107e14276ef39/Screenshot_2022-06-24_at_11.13.43_PM.png"/></a></figure></li></ol><h2 id="c8fddd5c-02ca-48a0-8e3d-2a8676dffe6f" class=""><strong>What Have We Accomplished</strong></h2><p id="fa83059b-f605-47d3-97fc-743e11eec295" class="">We have:</p><ul id="d0d0d2c8-e04f-4b9b-a94a-9643ac89224f" class="bulleted-list"><li style="list-style-type:disc">Created VPC with no Internet access</li></ul><ul id="975ad40c-d089-4e5d-b536-7d7af0e43f93" class="bulleted-list"><li style="list-style-type:disc">Onboarded the SageMaker Studio domain with network access type <strong>VPC only</strong> in an AWS Account in a region</li></ul><ul id="83015688-ace6-45b2-bb57-d269b098a125" class="bulleted-list"><li style="list-style-type:disc">Launched SageMaker Studio IDE</li></ul><ul id="5f186093-70c0-4138-990e-3de4500b5624" class="bulleted-list"><li style="list-style-type:disc">Configured SageMaker Studio Notebook environment to access AWS services from private subnet using VPC endpoints</li></ul><ul id="afef306a-a44b-419b-a3c2-a17bdabd5f71" class="bulleted-list"><li style="list-style-type:disc">Created SageMaker Studio Notebook</li></ul><ul id="c54a73b1-38d0-4f6e-bf73-57c778c46a8d" class="bulleted-list"><li style="list-style-type:disc">Integrate with Git for machine learning code management</li></ul><ul id="c4b3fc7c-c95f-40ce-9545-cf541444629c" class="bulleted-list"><li style="list-style-type:disc">Store every data in S3 Data Lake</li></ul><ul id="c5cbb52a-4a39-405d-a920-2c4f7f327e53" class="bulleted-list"><li style="list-style-type:disc">Offload heavy lifting data pre-processing and model training jobs in a notebook to SageMaker managed infrastructure</li></ul><ul id="d13b1794-2d8f-48a2-beb9-4b7eac6dee26" class="bulleted-list"><li style="list-style-type:disc">Pre-process data and trained a model in a secure environment</li></ul><p id="9778ba41-841a-4a04-b34b-204b419fe36b" class="">
</p><p id="f550474d-d6ea-4ebb-8a64-7b36973be18f" class="">Ref: <a href="https://catalog.us-east-1.prod.workshops.aws/workshops/c882cd42-8ec8-4112-9469-9fab33471e85/en-US/security-for-sysops/best-practice/best-practice-lab">https://catalog.us-east-1.prod.workshops.aws/workshops/c882cd42-8ec8-4112-9469-9fab33471e85/en-US/security-for-sysops/best-practice/best-practice-lab</a> </p></div></article></body></html>